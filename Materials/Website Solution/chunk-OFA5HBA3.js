import{a as P,c as U,d as G,f as z,h as J,i as K,m as Q,n as X,o as Y,q as Z,r as C}from"./chunk-MBJDGI6Y.js";import{c as j,d as h,e as q,f as _,g as H,k as W,w as ee}from"./chunk-SH7ULXOC.js";import{$a as V,Aa as x,La as d,Na as s,Pa as o,Qa as r,R as B,Sa as T,Ta as w,Ua as g,W as $,Z as u,Za as b,_a as m,ab as M,bb as L,cb as D,db as A,fb as R,ga as k,ha as F,ib as E,jb as O,ma as N,n as c,z as f,za as n}from"./chunk-URBSI3KC.js";var v=class{constructor(e,t){this.content=e;this.bookId=t}};function ne(i,e){i&1&&(o(0,"div"),m(1," Review must have content "),r())}function ae(i,e){i&1&&(o(0,"div"),m(1," Review must be at least 5 characters long "),r())}function se(i,e){if(i&1&&(o(0,"div",7),d(1,ne,2,0,"div",8)(2,ae,2,0,"div",8),r()),i&2){g();let t=b(6);n(),s("ngIf",t.errors==null?null:t.errors.required),n(),s("ngIf",t.errors==null?null:t.errors.minlength)}}var I=class i{bookId=0;review;createReview=new N;constructor(){}ngOnInit(){this.review=new v("",this.bookId)}submit(){this.createReview.emit(this.review)}static \u0275fac=function(t){return new(t||i)};static \u0275cmp=u({type:i,selectors:[["app-review-form"]],inputs:{bookId:"bookId"},outputs:{createReview:"createReview"},standalone:!0,features:[R],decls:10,vars:3,consts:[["reviewForm","ngForm"],["content","ngModel"],["name","reviewForm",1,"form-inline",3,"ngSubmit"],[1,"form-group"],["minlength","5","type","text","required","","name","content",1,"form-control",3,"ngModelChange","ngModel"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"],[4,"ngIf"]],template:function(t,a){if(t&1){let l=T();o(0,"form",2,0),w("ngSubmit",function(){return k(l),F(a.submit())}),o(2,"div",3)(3,"label"),m(4,"Review: "),o(5,"input",4,1),A("ngModelChange",function(S){return k(l),D(a.review.content,S)||(a.review.content=S),F(S)}),r()(),o(7,"button",5),m(8,"Add Review"),r()(),d(9,se,3,2,"div",6),r()}if(t&2){let l=b(1),p=b(6);n(5),L("ngModel",a.review.content),n(2),s("disabled",!l.form.valid),n(2),s("ngIf",!(p.valid||p.pristine))}},dependencies:[_,h,Y,K,P,U,G,Q,X,J,z]})};var y=class i{constructor(e){this.httpClient=e}getReviews(e){return this.httpClient.get(`${C.url}/reviews/${e}`)}getBook(e){return this.httpClient.get(`${C.url}/books/${e}`)}addReview(e){return this.httpClient.post(`${C.url}/reviews`,e)}static \u0275fac=function(t){return new(t||i)($(H))};static \u0275prov=B({token:i,factory:i.\u0275fac,providedIn:"root"})};function le(i,e){if(i&1&&(o(0,"div",6),m(1),r()),i&2){let t=g();n(),M(" Sorry, there's been an error communicating with the server: ",t.errorMessage,`
`)}}function pe(i,e){if(i&1&&(o(0,"tr")(1,"td"),m(2),r()()),i&2){let t=e.$implicit;s("@slideUp",void 0),n(2),V(t.content)}}var ie=class i{constructor(e,t){this.route=e;this.reviewService=t}bookId=-1;reviews$;book$;errorMessage="";showError(e){this.errorMessage=e.message?e.message:e.status?`${e.status} - ${e.statusText}`:"Server error"}getReviews(){this.reviews$=this.reviewService.getReviews(this.bookId).pipe(f(e=>(this.showError(e),c([]))))}getBook(){this.book$=this.reviewService.getBook(this.bookId).pipe(f(e=>(this.showError(e),c(new Z("","","",0)))))}addReview(e){e.bookId=this.bookId,this.reviewService.addReview(e).pipe(f(t=>(this.showError(t),c(new v("",0))))).subscribe({next:t=>{console.log("Review added successfully",t),this.getReviews()}})}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&(this.bookId=+e,this.getReviews(),this.getBook())}static \u0275fac=function(t){return new(t||i)(x(W),x(y))};static \u0275cmp=u({type:i,selectors:[["app-review-list"]],standalone:!0,features:[R],decls:15,vars:8,consts:[[3,"createReview","bookId"],["class","alert alert-danger",4,"ngIf"],[1,"row"],[1,"col-lg-8","col-sm-offset-1"],[1,"table","table-bordered","table-striped"],[4,"ngFor","ngForOf"],[1,"alert","alert-danger"]],template:function(t,a){if(t&1&&(o(0,"h1"),m(1),E(2,"async"),r(),o(3,"app-review-form",0),w("createReview",function(p){return a.addReview(p)}),r(),d(4,le,2,1,"div",1),o(5,"div",2)(6,"div",3)(7,"table",4)(8,"thead")(9,"tr")(10,"th"),m(11,"Review"),r()()(),o(12,"tbody"),d(13,pe,3,2,"tr",5),E(14,"async"),r()()()()),t&2){let l;n(),M("Reviews for ",(l=O(2,4,a.book$))==null?null:l.title,""),n(2),s("bookId",a.bookId),n(),s("ngIf",a.errorMessage),n(9),s("ngForOf",O(14,6,a.reviews$))}},dependencies:[_,j,h,q,I],data:{animation:[ee]}})};export{ie as ReviewListComponent};
