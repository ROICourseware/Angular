import{a as x,b as B,c as L,d as ne,e as ae,g as y,i as se,j as le,k as me,l as pe,p as H,q as de,r as O}from"./chunk-MBJDGI6Y.js";import{c as te,d as T,e as oe,f as w,g as re,m as ie,w as ce}from"./chunk-SH7ULXOC.js";import{$ as K,$a as Y,Aa as E,B as J,La as f,Na as m,Pa as n,Qa as i,R as W,Ra as v,Ta as u,Ua as I,Va as k,W as Z,Z as C,_a as s,aa as Q,ab as U,fb as S,hb as ee,ib as b,jb as h,ma as D,n as q,pa as X,wa as F,z as G,za as a}from"./chunk-URBSI3KC.js";var g=class o{transform(e,t="/images/NoImage.png"){return e||t}static \u0275fac=function(t){return new(t||o)};static \u0275pipe=Q({name:"noImage",type:o,pure:!0,standalone:!0})};var N=class o{constructor(e){this.el=e}dropped=new D;onDragOver(e){e.preventDefault(),this.el.nativeElement.style="border: 1px solid black"}onDragLeave(e){e.preventDefault(),this.el.nativeElement.style="border: none"}onDrop(e){e.preventDefault(),this.el.nativeElement.style="border: none",this.dropped.emit(e)}static \u0275fac=function(t){return new(t||o)(E(X))};static \u0275dir=K({type:o,selectors:[["","appDragAndDrop",""]],hostBindings:function(t,r){t&1&&u("dragover",function(l){return r.onDragOver(l)})("dragleave",function(l){return r.onDragLeave(l)})("drop",function(l){return r.onDrop(l)})},outputs:{dropped:"dropped"},standalone:!0})};function he(o,e){o&1&&(n(0,"div"),s(1," Title is required "),i())}function Be(o,e){o&1&&(n(0,"div"),s(1," Title must be at least 3 characters "),i())}function ye(o,e){o&1&&(n(0,"div"),s(1," Only letters and numbers are allowed "),i())}function _e(o,e){if(o&1&&(n(0,"div",7),f(1,he,2,0,"div",8)(2,Be,2,0,"div",8)(3,ye,2,0,"div",8),i()),o&2){let t=I();a(),m("ngIf",t.title.errors==null?null:t.title.errors.required),a(),m("ngIf",t.title.errors==null?null:t.title.errors.minlength),a(),m("ngIf",t.title.errors==null?null:t.title.errors.pattern)}}function Ce(o,e){o&1&&(n(0,"div",7),s(1,"Author is required"),i())}var M=class o{bookForm;createBook=new D;cover="";get title(){return this.bookForm.get("title")}get author(){return this.bookForm.get("author")}ngOnInit(){this.bookForm=new ae({title:new y("",[B.required,B.minLength(3),B.pattern("^[a-zA-Z0-9 ]*$")]),author:new y("",B.required)})}add(){let e=this.bookForm.value;this.createBook.emit(new de(e.title,e.author,this.cover,-1)),this.bookForm.reset(),this.cover=""}onDrop(e){let t=this,r=160,p,l,c,d,$=e.target.files||e.dataTransfer.files;if($&&$.length>0){let j=$[0],z=new FileReader;z.onload=(fe=>ve=>{let P=new Image;P.onload=function(){p=this.height,l=this.width,c=p,d=l,p>r&&(c=r,d=c*l/p),d>r&&(l=d,d=r,c=d*c/l);let _=document.createElement("canvas"),V=_.getContext("2d");_.width=d,_.height=c,V&&V.drawImage(P,0,0,d,c),t.cover=_.toDataURL(fe.type)},P.src=ve.target.result})(j),z.readAsDataURL(j)}}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=C({type:o,selectors:[["app-book-form"]],outputs:{createBook:"createBook"},standalone:!0,features:[S],decls:13,vars:7,consts:[[3,"ngSubmit","formGroup"],[1,"control-label"],["type","text","formControlName","title"],["type","text","formControlName","author"],["appDragAndDrop","",3,"dropped","src"],["type","submit",3,"disabled"],["class","alert alert-danger",4,"ngIf"],[1,"alert","alert-danger"],[4,"ngIf"]],template:function(t,r){t&1&&(n(0,"form",0),u("ngSubmit",function(){return r.add()}),n(1,"label",1),s(2," Title:"),v(3,"input",2),i(),n(4,"label",1),s(5," Author:"),v(6,"input",3),i(),n(7,"img",4),b(8,"noImage"),u("dropped",function(l){return r.onDrop(l)}),i(),n(9,"button",5),s(10," Add Book"),i(),f(11,_e,4,3,"div",6)(12,Ce,2,0,"div",6),i()),t&2&&(m("formGroup",r.bookForm),a(7),k("src",h(8,5,r.cover),F),a(2),m("disabled",r.bookForm.invalid),a(2),m("ngIf",r.title.invalid&&(r.title.dirty||r.title.touched)),a(),m("ngIf",(r.author.errors==null?null:r.author.errors.required)&&!r.author.pristine))},dependencies:[H,se,x,L,ne,me,pe,w,T,g,N]})};var R=class o{constructor(e){this.httpClient=e}getBooks(e=""){return e?this.httpClient.get(`${O.url}/booksbytitle/${e}`):this.httpClient.get(`${O.url}/books`)}addBook(e){return this.httpClient.post(`${O.url}/books`,e)}static \u0275fac=function(t){return new(t||o)(Z(re))};static \u0275prov=W({token:o,factory:o.\u0275fac,providedIn:"root"})};var Fe=o=>[o];function Ee(o,e){if(o&1&&(n(0,"div",8),s(1),i()),o&2){let t=I();a(),U(" Sorry, there's been an error communicating with the server: ",t.errorMessage,`
`)}}function Ie(o,e){if(o&1&&(n(0,"tr")(1,"td")(2,"a",9),s(3),i()(),n(4,"td"),s(5),i(),n(6,"td"),v(7,"img",10),b(8,"noImage"),i()()),o&2){let t=e.$implicit;m("@slideUp",void 0),a(2),m("routerLink",ee(8,Fe,"/reviews/"+t.bookId)),a(),U(" ",t.title,""),a(2),Y(t.author),a(2),k("src",h(8,6,t.cover),F),k("alt",t.title+" book cover")}}var ue=class o{constructor(e){this.bookService=e}books$;errorMessage="";searchField=new y;sub;getBooks(e=""){this.books$=this.bookService.getBooks(e).pipe(G(t=>(this.showError(t),q([]))))}addBook(e){this.bookService.addBook(e).pipe(G(t=>(this.showError(t),q({})))).subscribe(()=>this.getBooks())}ngOnInit(){this.getBooks(),this.sub=this.searchField.valueChanges.pipe(J(500)).subscribe({next:this.getBooks.bind(this),error:this.showError.bind(this)})}trackBook(e,t){return t.bookId}showError(e){this.errorMessage=e.message?e.message:e.status?`${e.status} - ${e.statusText}`:"Server error"}ngOnDestroy(){this.sub.unsubscribe()}static \u0275fac=function(t){return new(t||o)(E(R))};static \u0275cmp=C({type:o,selectors:[["app-book-list"]],standalone:!0,features:[S],decls:21,vars:6,consts:[[3,"createBook"],["class","alert alert-danger",4,"ngIf"],[1,"row"],[1,"col-lg-8","col-sm-offset-1"],[1,"table","table-bordered","table-striped"],["colspan","3"],["name","searchField",3,"formControl"],[4,"ngFor","ngForOf","ngForTrackBy"],[1,"alert","alert-danger"],[3,"routerLink"],[3,"src","alt"]],template:function(t,r){t&1&&(n(0,"h2"),s(1,"Books"),i(),n(2,"app-book-form",0),u("createBook",function(l){return r.addBook(l)}),i(),f(3,Ee,2,1,"div",1),n(4,"div",2)(5,"div",3)(6,"table",4)(7,"thead")(8,"tr")(9,"th"),s(10,"Title"),i(),n(11,"th"),s(12,"Author"),i()()(),n(13,"tbody")(14,"tr")(15,"td",5)(16,"label"),s(17,"Search by title: "),v(18,"input",6),i()()(),f(19,Ie,9,10,"tr",7),b(20,"async"),i()()()()),t&2&&(a(3),m("ngIf",r.errorMessage),a(15),m("formControl",r.searchField),a(),m("ngForOf",h(20,4,r.books$))("ngForTrackBy",r.trackBook))},dependencies:[w,te,T,oe,M,ie,g,H,x,L,le],data:{animation:[ce]}})};export{ue as BookListComponent};
