
var booksJSON = [{"bookId":67,"title":"Tom's Midnight Garden","cover":"http://ecx.images-amazon.com/images/I/6169-SiRAUL._AA160_.jpg","author":"Philippa Pearce"},{"bookId":66,"title":"The Borribles Go For Broke","cover":null,"author":"Michael de Larrabeiti"},{"bookId":65,"title":"The Borribles","cover":"http://ecx.images-amazon.com/images/I/51rreYSVemL._AA160_.jpg","author":"Michael de Larrabeiti"},{"bookId":64,"title":"Childhood's End","cover":"http://ecx.images-amazon.com/images/I/51ktGOkgYdL._AA160_.jpg","author":"Arthur C. Clarke"},{"bookId":63,"title":"The Forever War","cover":"http://ecx.images-amazon.com/images/I/51Ki76Qf64L._AA160_.jpg","author":"Joe Haldeman"},{"bookId":62,"title":"Northern Lights (US The Golden Compass)","cover":"http://ecx.images-amazon.com/images/I/513wgpJY44L._AA160_.jpg","author":"Philip Pullman"},{"bookId":61,"title":"All The King's Men","cover":"http://ecx.images-amazon.com/images/I/41E7166B09L._AA160_.jpg","author":"William Mayne"},{"bookId":60,"title":"The Blue World ","cover":"http://ecx.images-amazon.com/images/I/617b3IoqPzL._AA160_.jpg","author":"Jack Vance"},{"bookId":59,"title":"The Quare Fellow","cover":"http://ecx.images-amazon.com/images/I/51jiTpaySiL._AA160_.jpg","author":"Brendan Behan"},{"bookId":58,"title":"Camp Concentration","cover":"http://ecx.images-amazon.com/images/I/51B7H5PD10L._AA160_.jpg","author":"Thomas M. Disch"},{"bookId":57,"title":"Old Mali And The Boy","cover":null,"author":"D R Sherman"},{"bookId":56,"title":"The Owl Service","cover":"http://ecx.images-amazon.com/images/I/51ijxfQHoyL._AA160_.jpg","author":"Alan Garner"},{"bookId":55,"title":"The Farthest Shore","cover":"http://ecx.images-amazon.com/images/I/51Yu9ovXg1L._AA160_.jpg","author":"Ursula Le Guin"},{"bookId":54,"title":"The Tombs of Atuan","cover":"http://ecx.images-amazon.com/images/I/51CIf5MFrJL._AA160_.jpg","author":"Ursula Le Guin"},{"bookId":53,"title":"A Wizard of Earthsea","cover":"http://ecx.images-amazon.com/images/I/31b58qc0zAL._AA160_.jpg","author":"Ursula Le Guin"},{"bookId":52,"title":"The Alteration","cover":"http://ecx.images-amazon.com/images/I/416oY8mlRhL._AA160_.jpg","author":"Kingsley Amis"},{"bookId":51,"title":"A Fire Upon The Deep","cover":"http://ecx.images-amazon.com/images/I/51OrT3Zz+fL._AA160_.jpg","author":"Vernor Vinge"},{"bookId":50,"title":"Tiger Tiger (Stars My Destination)","cover":"http://ecx.images-amazon.com/images/I/51sGNkKQtKL._AA160_.jpg","author":"Alfred Bester"},{"bookId":49,"title":"Bug Jack Barron","cover":"http://ecx.images-amazon.com/images/I/51QpXsvBTbL._AA160_.jpg","author":"Norman Spinrad"},{"bookId":48,"title":"The Door Into Summer","cover":"http://ecx.images-amazon.com/images/I/41yBWAFvB7L._AA160_.jpg","author":"Robert Heinlein"},{"bookId":47,"title":"Orphans of the Sky","cover":"http://ecx.images-amazon.com/images/I/51oqYQxRelL._AA160_.jpg","author":"Robert Heinlein"},{"bookId":46,"title":"Between Planets","cover":"http://ecx.images-amazon.com/images/I/41ChVv+YKbL._AA160_.jpg","author":"Robert Heinlein"},{"bookId":45,"title":"The Unpleasant Profession of Jonathan Hoag","cover":"http://ecx.images-amazon.com/images/I/51OfxRCZrvL._AA160_.jpg","author":"Robert Heinlein"},{"bookId":44,"title":"The Moon is a Harsh Mistress","cover":"http://ecx.images-amazon.com/images/I/410BnoLMnoL._AA160_.jpg","author":"Robert Heinlein"},{"bookId":43,"title":"Revolt in 2100","cover":"http://ecx.images-amazon.com/images/I/51cUMkHZoyL._AA160_.jpg","author":"Robert Heinlein"},{"bookId":42,"title":"Stranger in a Strange Land","cover":"http://ecx.images-amazon.com/images/I/51CQT4vsHJL._AA160_.jpg","author":"Robert Heinlein"},{"bookId":41,"title":"Starship Troopers","cover":"http://ecx.images-amazon.com/images/I/51T3Iwe0YZL._AA160_.jpg","author":"Robert Heinlein"},{"bookId":40,"title":"The Dragon's Quest","cover":"http://ecx.images-amazon.com/images/I/51tSZ1GExfL._AA160_.jpg","author":"Rosemary Manning"},{"bookId":39,"title":"The Forest of Boland Light Railway","cover":"http://ecx.images-amazon.com/images/I/51PRP64-+mL._AA160_.jpg","author":"BB"},{"bookId":38,"title":"The Blue Hawk","cover":"http://ecx.images-amazon.com/images/I/51KHloOK1NL._AA160_.jpg","author":"Peter Dickinson"},{"bookId":37,"title":"Dying Inside","cover":"http://ecx.images-amazon.com/images/I/41nQ0AW-dLL._AA160_.jpg","author":"Robert Silverberg"},{"bookId":36,"title":"The Hollow Hills","cover":"http://ecx.images-amazon.com/images/I/51VN3z8WTnL._AA160_.jpg","author":"Mary Stewart"},{"bookId":35,"title":"The Crystal Cave","cover":"http://ecx.images-amazon.com/images/I/51IjQJ2CfJL._AA160_.jpg","author":"Mary Stewart"},{"bookId":34,"title":"The Knights of the Limits","cover":"http://ecx.images-amazon.com/images/I/616Aablnr9L._AA160_.jpg","author":"Barrington J. Bayley"},{"bookId":33,"title":"The Zen Gun","cover":"http://ecx.images-amazon.com/images/I/51ljdGUGNPL._AA160_.jpg","author":"Barrington J. Bayley"},{"bookId":32,"title":"The Grand Wheel","cover":"http://ecx.images-amazon.com/images/I/61P8EEGqlWL._AA160_.jpg","author":"Barrington J. Bayley"},{"bookId":31,"title":"The Soul of the Robot","cover":"http://ecx.images-amazon.com/images/I/51U4SXS28mL._AA160_.jpg","author":"Barrington J. Bayley"},{"bookId":30,"title":"The Fall of Chronopolis","cover":"http://ecx.images-amazon.com/images/I/4111R5tQkeL._AA160_.jpg","author":"Barrington J. Bayley"},{"bookId":29,"title":"The Pillars of Eternity","cover":"http://ecx.images-amazon.com/images/I/41PEVg6bf7L._AA160_.jpg","author":"Barrington J. Bayley"},{"bookId":28,"title":"Collision With Chronos (Collision Course)","cover":"http://ecx.images-amazon.com/images/I/41Lut2VxAwL._AA160_.jpg","author":"Barrington J. Bayley"},{"bookId":27,"title":"Star Winds","cover":null,"author":"Barrington J. Bayley"},{"bookId":26,"title":"The Garments of Caean","cover":"http://ecx.images-amazon.com/images/I/41eg4y-IQxL._AA160_.jpg","author":"Barrington J. Bayley"},{"bookId":25,"title":"To Kill A Mockingbird","cover":"http://ecx.images-amazon.com/images/I/51grMGCKivL._AA160_.jpg","author":"Harper Lee"},{"bookId":24,"title":"One Flew Over the Cuckoo's Nest","cover":"http://ecx.images-amazon.com/images/I/416Et8Tk+4L._AA160_.jpg","author":"Ken Kesey"},{"bookId":23,"title":"Flashman And The Great Game","cover":"http://ecx.images-amazon.com/images/I/51xU9BPvSkL._AA160_.jpg","author":"George MacDonald Fraser"},{"bookId":22,"title":"Flashman And The Dragon","cover":"http://ecx.images-amazon.com/images/I/51+1vThhDIL._AA160_.jpg","author":"George MacDonald Fraser"},{"bookId":21,"title":"Flashman At The Charge","cover":"http://ecx.images-amazon.com/images/I/51AUPtw8iyL._AA160_.jpg","author":"George MacDonald Fraser"},{"bookId":20,"title":"Flashman And The Redskins","cover":"http://ecx.images-amazon.com/images/I/51qoMI+43zL._AA160_.jpg","author":"George MacDonald Fraser"},{"bookId":19,"title":"Shogun","cover":"http://ecx.images-amazon.com/images/I/51a0jeqEqAL._AA160_.jpg","author":"James Clavell"},{"bookId":18,"title":"Neutron Star","cover":"http://ecx.images-amazon.com/images/I/51PfwCb7+xL._AA160_.jpg","author":"Larry Niven"},{"bookId":17,"title":"Protector","cover":"http://ecx.images-amazon.com/images/I/51pLogY62jL._AA160_.jpg","author":"Larry Niven"},{"bookId":16,"title":"World of Ptavvs ","cover":"http://ecx.images-amazon.com/images/I/51NvGcIKtZL._AA160_.jpg","author":"Larry Niven"},{"bookId":15,"title":"A Gift From Earth","cover":"http://ecx.images-amazon.com/images/I/51VDE1A61GL._AA160_.jpg","author":"Larry Niven"},{"bookId":14,"title":"Dawn of Fear","cover":"http://ecx.images-amazon.com/images/I/51LuqtHHzYL._AA160_.jpg","author":"Susan Cooper"},{"bookId":13,"title":"Greenwitch","cover":"http://ecx.images-amazon.com/images/I/51j185RNGCL._AA160_.jpg","author":"Susan Cooper"},{"bookId":12,"title":"The Dark Is Rising","cover":"http://ecx.images-amazon.com/images/I/511uMcFfDiL._AA160_.jpg","author":"Susan Cooper"},{"bookId":11,"title":"The Power of Three ","cover":"http://ecx.images-amazon.com/images/I/51inc1bRsnL._AA160_.jpg","author":"Diana Wynne Jones"},{"bookId":10,"title":"Drowned Ammet ","cover":"http://ecx.images-amazon.com/images/I/51wy1cz212L._AA160_.jpg","author":"Diana Wynne Jones"},{"bookId":9,"title":"Cart And Cwidder","cover":"http://ecx.images-amazon.com/images/I/51l5WaoehXL._AA160_.jpg","author":"Diana Wynne Jones"},{"bookId":8,"title":"Archer's Goon ","cover":"http://ecx.images-amazon.com/images/I/51iTMpo6+0L._AA160_.jpg","author":"Diana Wynne Jones"},{"bookId":7,"title":"Nothing to be Afraid Of","cover":"http://ecx.images-amazon.com/images/I/41QAZ3AAJDL._AA160_.jpg","author":"Jan Mark"},{"bookId":6,"title":"The Hobbit","cover":"http://ecx.images-amazon.com/images/I/41aQPTCmeVL._AA160_.jpg","author":"J R R Tolkien"},{"bookId":4,"title":"Divide And Rule","cover":"http://ecx.images-amazon.com/images/I/51GtYtQr-NL._AA160_.jpg","author":"Jan Mark"},{"bookId":3,"title":"The Ennead","cover":"http://ecx.images-amazon.com/images/I/51-TbYCvYvL._AA160_.jpg","author":"Jan Mark"},{"bookId":1,"title":"The Lord Of The Rings","cover":"http://ecx.images-amazon.com/images/I/51eq24cRtRL._AA160_.jpg","author":"J R R Tolkien"}];
var reviewsJSON = [{"content":"What can I say?  I read it in 2 days when I was 12... and ever since have wanted to recapture that feeling of reading it for the first time.  The greatest book anyone has ever written - provided, I suspect, you read it at the right time in your life.  I don't know how I would react to it now, but this would be my Desert Island book.","bookId":1},{"content":"One of the best Science Fiction books around.  Like much of Jan Mark's best work, it is not a happy tale - but it is an enormously powerful one.","bookId":3},{"content":"I had the great privelege of knowing Jan Mark a little - though much more as a fan than a friend.  I asked her once whether the central character dies at the end: her reply - that no, the really sad thing was she did not think he did... Not the happiest of books, but it should be on everyone's Must Read list.","bookId":4},{"content":"What can I say?  Read it at 11.  Fell in love with Tolkien. Have never fallen out again.","bookId":6},{"content":"The title story - and another, \"William's Version\" are amongst the most perfect short stories anyone has ever written.","bookId":7},{"content":"A wonderful fantasy that makes the everyday - from council workers to supermarkets - strange and magical. ","bookId":8},{"content":"Forget Harry Potter.  Diana Wynne Jones writes the best children's fantasy around - and this one is one of her best.","bookId":9},{"content":"A haunting novel, full of betrayal and self-delusion, with an end that fizzes with so much genuine magic, it makes the hair stand up on the back of my neck.","bookId":10},{"content":"How many children's books begin with one of the characters bullying another... and killing him.  Stunning.","bookId":11},{"content":"The second book in the sequence, but the first really good one.  Many of the elements are familiar - child who discovers secret powers/high mission; the wild hunt - but they are put together with originaility and that indefinable quality which makes magic come alive.","bookId":12},{"content":"The middle book in The Dark is Rising sequence, and a wonderful poignant tale.  It captures something of the strange magic that old folk customs have - the lingering mystery of peculiar behaviour kept up for no other reason than it has been the custom locally since time out of mind.","bookId":13},{"content":"A simply perfect story.  ","bookId":14},{"content":"It seems from the Amazon reviews that not everyone likes this one.  Some of the criticism are particularly stupid (e.g. it's in the future, and they are not using the metric system), and I beg to differ.  One of my favourite Niven's (and that's saying a lot).","bookId":15},{"content":"Yet more brilliant aliens from Niven.","bookId":16},{"content":"Niven's trademark wonderful aliens... and according to the premise, not quite so alien as they at first appear.","bookId":17},{"content":"Some wonderful aliens in a fun set of stories.  I love puppeteers. ","bookId":18},{"content":"It's too short!  I want another thousand pages!  Clavell manages to transport you into a different world, and a different way of thinking - and along the way, to make you understand and sympathise with what appears at first site to be an appalling and alien culture.","bookId":19},{"content":"Probably my favourite Flashman.  In a footnote, it lists one of my favourite pearls of wisdom - to paraphrase: if you think an Apache doesn't know right from wrong, wrong him and see what he does.","bookId":20},{"content":"Another fine Flashman - the only man who was in the Thin Red Line, the charge of the Heavy Brigade and, of course, the charge of the Light Brigade.","bookId":21},{"content":"Flashman squeals, bolts and rogers his way through China.  MacDonald Fraser on top form.","bookId":22},{"content":"A wonderful romp through Kipling territory... but perhaps not quite as Kipling himself would have done it.","bookId":23},{"content":"As good as a book as it is as a film.","bookId":24},{"content":"\"Stand up children, your father's passing.\"  ","bookId":25},{"content":"Do the clothes make the man?  They do in this weird and wonderful romp.","bookId":26},{"content":"It turns out that modern science is simply a dead end.  The real truth is in alchemy...  Just brilliant - and so much more aware of the conditional nature of current certainties than lesser SF.","bookId":27},{"content":"What can I say?  Barry Bailey casually throws in more ideas on a single page than most writers put in a single book.  A man perhaps more admired by other SF writers than known amongst the general public. \r\n<p>In \"Collision\", an archaeologist in a racist future realises the ruins he is working on are getting younger, not older....</p>","bookId":28},{"content":"More alchemy from Bailey - and a man with an existential problem to end all existential problems...","bookId":29},{"content":"Where to begin?  A fun romp through different ideas of time and reality.  Nobody does this kind of thing better.","bookId":30},{"content":"Bailey does the soul.","bookId":31},{"content":"Barry Bailey doing his thing - this time riffing on gambling and luck.","bookId":32},{"content":"I can maim and I can kill, with my Zen Gun....","bookId":33},{"content":"I read these stories, and felt my mind expanding.  The best collection of SF stories there is.","bookId":34},{"content":"The boyhood of Merlin; neither quite realist nor heavily fantasy - but superb and original.","bookId":35},{"content":"Sequel to the Crystal Cave.  This time it is the childhood of Arthur seen from the point of view of Merlin. ","bookId":36},{"content":"Not a happy read - what did you expect from the title? - but a magnificent book.  A telepath coming to terms with the fading of his powers.  If this were not SF, it would be regarded as a classic.","bookId":37},{"content":"A vision of a world like ancient Egypt, but not...  Science Fiction, but with a strong fantasy feel.  Wonderful.","bookId":38},{"content":"I find it depressing that this is not as much a part of everyone's childhood as, say, Winnie the Pooh.  If you know a child who has not read this, buy them a copy.  Something is badly wrong with a world where this is out of print.","bookId":39},{"content":"Blew me away when I was eight.  Still does.","bookId":40},{"content":"Forget the film.  Read the book.  Then burn your copy of the film - if you have one.","bookId":41},{"content":"The fosterites, conga-ing for Jesus, remain one of the most powerful images of happy-clappies gone mad that I have ever come across.","bookId":42},{"content":"I read this when I was 11 or so - and this was the book that made me realise that I wasn't just a reader: I was a Science Fiction reader.  The first of the 3 stories is far the best, and its rare for a couple of years to go by without my having re-read it.","bookId":43},{"content":"The US revolution (mutiny!), but the rebelling colony is the moon (and it's a lot more like Australia than the US).  Great fun - and the first example in fiction of a conscious computer.","bookId":44},{"content":"\"All you Zombies\" is the perfect Time Travel story.","bookId":45},{"content":"One of the best of Heinlein's children's books.  SF, but with \"dragons\".  Charming.","bookId":46},{"content":"The original and best story about a spaceship whose inhabitants have forgotten it is a ship, and come to believe that it is a world","bookId":47},{"content":"Classic Heinlein - time travel and robots.  Lots of fun.","bookId":48},{"content":"A vision of the media as it could become... arguably has beocome in the years since it was written. ","bookId":49},{"content":"The final paragraph is missing.  It would read: \"and then the world blew up\", but what the heck.  Great book.","bookId":50},{"content":"I read \"Fire\" for the first time about three years ago (thanks for the recommendation, Bernard).  Since then I've re-read it twice.  A stunning novel, with an astonishing breadth of imagination.","bookId":51},{"content":"An elegant alternate history story.","bookId":52},{"content":"Magic as it should be.  The first of the Earthsea books, and it remains one of the best children's fantasy novels.","bookId":53},{"content":"Middle of the original three Earthsea books.  Can be harder to get into, but repays the effort.","bookId":54},{"content":"The third Earthsea book - and the last one to read.  Don't bother with the sequels; they would have been good in themselves, but they come from such a different viewpoint from the original three that they don't really work together.  This one is a medition on death, meaning and existence - and has some of the greatest images ever committed to paper.","bookId":55},{"content":"The last couple of pages blow it, rather, but teh rest of it is a superb claustrophobic tale.  For me, this is far Garner's best book.","bookId":56},{"content":"Not a word out of place.","bookId":57},{"content":"I once michievously piled furniture into a hotel lift with Thomas M. Disch.  Not relevant, I know - but how many people can say that?  For me, this is his best book.","bookId":58},{"content":"A great play - at least to read on the page.  I've still never managed to catch a production.","bookId":59},{"content":"\"Chairman of the Quatrefoil bezzlers\".  Need I say more?","bookId":60},{"content":"The man is appalling, but the title story of this collection is just perfect.","bookId":61},{"content":"The first - and far the best - of Pullman's trilogy.  Number two suffers from middle book syndrome, and number three is a cop out: what is built up to be a true revolt against God turns into an attack not on the creator, but on some other being who is claiming the credit.  In other - yawn - words, just another attack on -yawn - the established church.  But this one, with its ideas of the changeabale daemons/souls of children, the fixed souls of adults and great chrome in the shape of armoured Polar Bears, is a delight.","bookId":62},{"content":"Not an antidote to Starship Troopers - more a novel about conscripts, where Starship Troopers is about volunteers.","bookId":63},{"content":"Why doesn't someone make a movie of this, instead of all the rubbish they keep churning out.  A book that is flawed, and creaky in places - but utterly wonderful.","bookId":64},{"content":"Feral children live amongst us, facing dangers like the heros of ancient sagas.  Unique and brilliant","bookId":65},{"content":"The feral Peter Pans massacre things that look and sound remarkably like Wombles...","bookId":66},{"content":"Magical story of time travel and friendship.","bookId":67},{"content":"super","bookId":67},{"content":"test","bookId":66}];

// GET
exports.books = function (req, res, next) {
    console.log('*** books');
	
    res.json(booksJSON);
};

exports.book = function (req, res, next) {
    console.log('*** book by id');
    var r = {};
    for (let i = 0 ; i < booksJSON.length ; i++) {
        if (booksJSON[i].bookId == req.params.bookId) {
            res.json(booksJSON[i]);
            break;
        }
    }
};

exports.booksByTitle = function (req, res, next) {
    console.log('*** booksby title');
	var r = [];
    for (let i = 0 ; i < booksJSON.length ; i++) {
        if (booksJSON[i].title.toLowerCase().indexOf(req.params.title.toLowerCase()) != -1) {
			r.push(booksJSON[i]);
        }
    }
	res.json(r);
};

exports.reviews = function (req, res, next) {
    console.log('*** reviews');
	var r = [];
    for (let i = 0 ; i < reviewsJSON.length ; i++) {
        if (reviewsJSON[i].bookId == req.params.bookId) {
			r.push(reviewsJSON[i]);
			console.log(reviewsJSON[i].bookId);
        }
    }
	res.json(r);


};

exports.addReview = function (req, res, next) {
    console.log('*** addReview');
    reviewsJSON.splice(0, 0, req.body);
	res.json(req.body);
};


exports.addBook = function (req, res, next) {
    console.log('*** addBook');

	const bookId = booksJSON[0].bookId+1;
	let book = req.body;
	book.bookId = bookId;
	booksJSON.splice(0, 0, book);
	res.json(book);
};


